pierisGenome <- readAAStringSet(file = "Pieris_rapae_proteins.fa")
BiocManager::install("Biostrings")
library(Biostrings)
pierisGenome <- readAAStringSet(file = "Pieris_rapae_proteins.fa")
geneAAsetsList <- split(pierisGenome, f = prot.mtx[,2])
lengthSS <- sapply(geneAAsetsList, length)
geneAAsetsListuniq <- lapply(geneAAsetsList, unique)
lengthSSUnique <- sapply(geneAAsetsListuniq, length) #Length = count of transcripts
plot(x = lengthSS, y = lengthSSUnique, pch = 19, xlab = "Original Count",
ylab = "Unique Transcripts", col = rgb(0,0,0,0.1))
#The barplot below is of the original counts of the genome.
lengthSSTable <- table(lengthSS) #Tabulate the counts
barplot(lengthSSTable, xlab = "Count Length", ylab = "Frequency",
main = "Original Counts", ylim = c(0,10000), space = 0)
#The barplot below is of the unique counts of the genome.
lengthSSUniqueTable <- table(lengthSSUnique) #Tabulate the counts
barplot(lengthSSUniqueTable, xlab = "Count Length", ylab = "Frequency",
main = "Unique Transcripts", ylim = c(0,10000),
space = 0)
#This barplot shows the difference (in counts) between the two previous plots.
diffLengths <- lengthSS - lengthSSUnique
diffLengthsTable <- table(diffLengths) #Tabulate the counts
barplot(diffLengthsTable, xlab = "Count Length", ylab = "Frequency",
main = "Difference Between Original and Unique Transcript Length", ylim = c(0,12000), space = 0)
#The plot below demonstrates per gene the redundant and unique versions of transcript:
geneAAsetsList <- split(pierisGenome, f = prot.mtx[,2])
#The plot below demonstrates per gene the redundant and unique versions of transcript:
prot.mtx <- do.call(what = rbind, args = geneID)
#The plot below demonstrates per gene the redundant and unique versions of transcript:
geneID <- strsplit(names(pierisGenome), split = " gene=")
prot.mtx <- do.call(what = rbind, args = geneID)
geneAAsetsList <- split(pierisGenome, f = prot.mtx[,2])
lengthSS <- sapply(geneAAsetsList, length)
geneAAsetsListuniq <- lapply(geneAAsetsList, unique)
lengthSSUnique <- sapply(geneAAsetsListuniq, length) #Length = count of transcripts
plot(x = lengthSS, y = lengthSSUnique, pch = 19, xlab = "Original Count",
ylab = "Unique Transcripts", col = rgb(0,0,0,0.1))
#The barplot below is of the original counts of the genome.
lengthSSTable <- table(lengthSS) #Tabulate the counts
barplot(lengthSSTable, xlab = "Count Length", ylab = "Frequency",
main = "Original Counts", ylim = c(0,10000), space = 0)
#The barplot below is of the unique counts of the genome.
lengthSSUniqueTable <- table(lengthSSUnique) #Tabulate the counts
barplot(lengthSSUniqueTable, xlab = "Count Length", ylab = "Frequency",
main = "Unique Transcripts", ylim = c(0,10000),
space = 0)
#This barplot shows the difference (in counts) between the two previous plots.
diffLengths <- lengthSS - lengthSSUnique
diffLengthsTable <- table(diffLengths) #Tabulate the counts
barplot(diffLengthsTable, xlab = "Count Length", ylab = "Frequency",
main = "Difference Between Original and Unique Transcript Length", ylim = c(0,12000), space = 0)
##INTERMEDIATE STEP - generate list of longest sequence (for representative purposes) for each gene
# str(geneAAsetsListuniq)
indexSeq <- which.max(width(geneAAsetsListuniq[[2]])) #Index that reflects the longest transcript
geneAAsetsListuniq[[2]][indexSeq] #Subset to get longest StringSetObject
width(geneAAsetsListuniq[[2]][indexSeq])
#Create a function
getLongest <- function(x) {
indexSeq <- which.max(width(x))
longestSSObject <- x[indexSeq]
return(longestSSObject)
}
#Put defined function into lapply
longestSeq <- lapply(geneAAsetsList, FUN = getLongest)
head(longestSeq)
width(longestSeq[[2]])
geneLength <- lapply(longestSeq, FUN = width)
head(geneLength)
##PLOT
plot(x = geneLength, y = lengthSSUnique, pch = 19, xlab = "Gene Length",
ylab = "Unique Transcripts", col = rgb(0,0,0,0.1))
#--------------------------------------------------------------------------------------------------------------
#Therefore --> Need to Clean the Data
#Record of gene identifiers corresponding to their transcripts
geneID <- strsplit(names(pierisGenome), split = " gene=") #Using the split function
#Unlist the geneID variable and create a matrix:
#use do.call() to iteratively rbind list elements into a matrix
prot.mtx <- do.call(what = rbind, args = geneID)
genesIDList <- split( x=prot.mtx[,1], f=prot.mtx[,2])
geneAAsetsList <- split(pierisGenome, f = prot.mtx[,2]) #Use split function
#Look at Output
geneAAsetsList[[2]]
geneAAsetsList[["Gucy1b3"]]
#Then use lapply and unique
geneAAsetsListuniq <- lapply(geneAAsetsList, unique)
##Generating the Table
geneinfo <- read.table(file = "geneID.txt", sep =";", header = FALSE, quote = "", as.is = T)   #15047 gene IDs
names(geneinfo)[1] <- "GeneID"
##Generating the Table
geneinfo <- read.table(file = "geneID.txt", sep =";", header = FALSE, quote = "", as.is = T)   #15047 gene IDs
names(geneinfo)[1] <- "GeneID"
names(geneinfo)[2] <- "GeneName"
geneinfo$GeneID <- gsub("ID=", "", geneinfo$GeneID)
geneinfo$GeneName <- gsub("Name=", "", geneinfo$GeneName)
geneinfo[geneinfo$GeneID == "PIERAPG00000014530", ]
mrnainfo <- read.table(file ="mrnaID.txt", sep =";", header = FALSE, as.is = T)
names(mrnainfo)[1] <- "TranscriptID"
names(mrnainfo)[2] <- "GeneID"
mrnainfo$TranscriptID <- gsub("ID=", "", mrnainfo$TranscriptID)
IDList <- merge(geneinfo,mrnainfo)
IDList[IDList$GeneID == "PIERAPG00000014530", ]
##Generating the Table
geneinfo <- read.table(file = "geneID.txt", sep =";", header = FALSE, quote = "", as.is = T)   #15047 gene IDs
names(geneinfo)[1] <- "GeneID"
names(geneinfo)[2] <- "GeneName"
geneinfo$GeneID <- gsub("ID=", "", geneinfo$GeneID)
geneinfo$GeneName <- gsub("Name=", "", geneinfo$GeneName)
mrnainfo <- read.table(file ="mrnaID.txt", sep =";", header = FALSE, as.is = T)
names(mrnainfo)[1] <- "TranscriptID"
names(mrnainfo)[2] <- "GeneID"
mrnainfo$TranscriptID <- gsub("ID=", "", mrnainfo$TranscriptID)
mrnainfo$GeneID <- gsub("Parent=", "", mrnainfo$GeneID)
IDList <- merge(geneinfo,mrnainfo)
#Write out to a table
write.csv(x=IDList, file="IDList.csv", row.names = F, quote=T)
##Upload pierisGenome dataset
pierisGenome <- readAAStringSet(file = "Pieris_rapae_proteins.fa")
#Update names in FASTA file using the previously generated table
#Output 35000 genes
protNames <- names(pierisGenome)
#Use the `match()` function to subset geneinfo$GeneID in a way that is consistent with the ordering and identity of transcript IDs on AAstringset read from fasta.
trxList <- strsplit(names(pierisGenome), split = " gene=")  #Parse fasta header from AAStringSet into list of unique IDs
prot.mtx <- do.call(what = rbind, args = trxList) #Turn this list into a matrix, so can access only trxID or GeneName directly
prot.geneID <- geneinfo$GeneID[match(prot.mtx[,2], table = geneinfo$GeneName )] #Use match to get GeneID values corresponding to GeneNames in the fasta ordering
#Now we can paste these together to give the new IDs for the AAStringSet
newNamesKeys <- paste0(prot.mtx[,1], " geneID=", prot.geneID, " genename=", prot.mtx[,2])
names(pierisGenome) <- newNames
#Now we can paste these together to give the new IDs for the AAStringSet
newNames <- paste(prot.mtx[,1], prot.geneID, prot.mtx[,2])
newNamesKeys <- paste0(prot.mtx[,1], " geneID=", prot.geneID, " genename=", prot.mtx[,2])
names(pierisGenome) <- newNames
#Write out FASTA file
writeXStringSet(x = geneAAsetsListuniq, filepath = "PierisRenamedProteins.fas")
geneAAsetsListuniq <- unlist(geneAAsetsListuniq)
#Write out FASTA file
writeXStringSet(x = geneAAsetsListuniq, filepath = "PierisRenamedProteins.fas")
geneAAsetsListuniq <- unlist(geneAAsetsListuniq)
#Write out FASTA file
writeXStringSet(x = geneAAsetsListuniq, filepath = "PierisRenamedProteins.fas")
#Write out FASTA file
writeXStringSet(x = names(pierisGenome), filepath = "PierisRenamedProteins.fas")
names(pierisGenome) <- newNames
#Write out FASTA file
writeXStringSet(x = names(pierisGenome), filepath = "PierisRenamedProteins.fas")
str(names(pierisGenome))
names(pierisGenome)
#Now we can paste these together to give the new IDs for the AAStringSet
newNames <- paste(prot.mtx[,1], prot.geneID, prot.mtx[,2])
newNamesKeys <- paste0(prot.mtx[,1], " geneID=", prot.geneID, " genename=", prot.mtx[,2])
newNamesKeys
names(pierisGenome) <- newNames
names(pierisGenome)
#Write out FASTA file
writeXStringSet(x = pierisGenome, filepath = "PierisRenamedProteins.fas")
width(names(pierisGenome))
length(names(pierisGenome))
names(pierisGenome) <- newNames
length(names(pierisGenome))
names(pierisGenome) <- newNames
length(names(pierisGenome))
#Now we can paste these together to give the new IDs for the AAStringSet
newNames <- paste(prot.mtx[,1], prot.geneID, prot.mtx[,2])
newNamesKeys <- paste0(prot.mtx[,1], " geneID=", prot.geneID, " genename=", prot.mtx[,2])
newNamesKeys
names(pierisGenome) <- newNames
length(names(pierisGenome))
#Write out FASTA file
writeXStringSet(x = pierisGenome, filepath = "PierisRenamedProteins.fas")
#Write out FASTA file
writeXStringSet(x = names(pierisGenome), filepath = "PierisRenamedProteins.fas")
#Write out FASTA file
writeXStringSet(x = pierisGenome, filepath = "PierisRenamedProteins.fas") #Get
length(names(pierisGenome))
length(pierisGenome)
#--------------------------------------------------------------------------------------------------------------
#Reduce redundancy - still allows for isoforms
#Generate Object with non-redundancy
##Necessary Code Previously Generated
prot.mtx <- do.call(what = rbind, args = geneID)
genesIDList <- split( x=prot.mtx[,1], f=prot.mtx[,2])
#Use split function (f = prot.mtx[,2])
geneAAsetsList <- split(pierisGenome, f = prot.mtx[,2]) #In a single line of code
#Then use lapply and unique
geneAAsetsListuniq <- lapply(geneAAsetsList, unique)
#Write out FASTA file
writeXStringSet(x = geneAAsetsListuniq, filepath = "PierisNonRedundant.fas")
geneAAsetsListuniq
str(geneAAsetsListuniq)
#Write out FASTA file
writeXStringSet(x = geneAAsetsListuniq, filepath = "PierisNonRedundant.fas")
geneAAsetsListuniq <- unlist(geneAAsetsList)
str(geneAAsetsListuniq) #A vector of Biostrings?
#Write out FASTA file
writeXStringSet(x = geneAAsetsListuniq, filepath = "PierisNonRedundant.fas")
#--------------------------------------------------------------------------------------------------------------
#Reduce redundancy - still allows for isoforms
#Generate Object with non-redundancy
pierisRenamedGenome <- readAAStringSet(file = "PierisRenamedProteins.fa")
setwd("~/OneDrive - University of Kansas/PierisProteomeProject")
##Necessary Code Previously Generated
prot.mtx <- do.call(what = rbind, args = geneID)
#--------------------------------------------------------------------------------------------------------------
#Reduce redundancy - still allows for isoforms
#Generate Object with non-redundancy
pierisRenamedGenome <- readAAStringSet(file = "PierisRenamedProteins.fa")
setwd("~/OneDrive - University of Kansas/PierisProteomeProject/RawData")
#--------------------------------------------------------------------------------------------------------------
#Reduce redundancy - still allows for isoforms
#Generate Object with non-redundancy
pierisRenamedGenome <- readAAStringSet(file = "PierisRenamedProteins.fa")
#--------------------------------------------------------------------------------------------------------------
#Reduce redundancy - still allows for isoforms
#Generate Object with non-redundancy
pierisRenamedGenome <- readAAStringSet(file = "PierisRenamedProteins.fa")
#Use split function (f = prot.mtx[,2])
geneAAsetsList <- split(pierisRenamedGenome, f = prot.mtx[,2]) #In a single line of code
#--------------------------------------------------------------------------------------------------------------
#Reduce redundancy - still allows for isoforms
#Generate Object with non-redundancy
pierisRenamedGenome <- readAAStringSet(file = "PierisRenamedProteins.fa")
#--------------------------------------------------------------------------------------------------------------
#Reduce redundancy - still allows for isoforms
#Generate Object with non-redundancy
pierisRenamedGenome <- readAAStringSet(file = "PierisRenamedProteins.fa")
#--------------------------------------------------------------------------------------------------------------
#Reduce redundancy - still allows for isoforms
#Generate Object with non-redundancy
pierisRenamedGenome <- readXSStringSet(file = "PierisRenamedProteins.fa")
#--------------------------------------------------------------------------------------------------------------
#Reduce redundancy - still allows for isoforms
#Generate Object with non-redundancy
pierisRenamedGenome <- readXStringSet(file = "PierisRenamedProteins.fa")
#--------------------------------------------------------------------------------------------------------------
#Reduce redundancy - still allows for isoforms
#Generate Object with non-redundancy
pierisRenamedGenome <- readAAStringSet(file = "PierisRenamedProteins.fa")
#--------------------------------------------------------------------------------------------------------------
#Reduce redundancy - still allows for isoforms
#Generate Object with non-redundancy
pierisRenamedGenome <- readAAStringSet(file = "PierisRenamedProteins.fa")
#Write out FASTA file
writeAAStringSet(x = pierisGenome, filepath = "PierisRenamedProteins.fas") #Checked in terminal - 310,369 lines?
#Write out FASTA file
writeXStringSet(x = pierisGenome, filepath = "PierisRenamedProteins.fas") #Checked in terminal - 310,369 lines?
#--------------------------------------------------------------------------------------------------------------
#Reduce redundancy - still allows for isoforms
#Generate Object with non-redundancy
pierisRenamedGenome <- readAAStringSet(file = "PierisRenamedProteins.fa")
#--------------------------------------------------------------------------------------------------------------
#Reduce redundancy - still allows for isoforms
#Generate Object with non-redundancy
pierisRenamedGenome <- readAAStringSet(file = "PierisRenamedProteins.fas")
##Necessary Code Previously Generated
prot.mtx <- do.call(what = rbind, args = geneID)
genesIDList <- split( x=prot.mtx[,1], f=prot.mtx[,2])
#Use split function (f = prot.mtx[,2])
geneAAsetsList <- split(pierisRenamedGenome, f = prot.mtx[,2])
#Then use lapply and unique
geneAAsetsListuniq <- lapply(geneAAsetsList, unique)
geneAAsetsListuniq <- unlist(geneAAsetsList)
#Write out FASTA file
writeXStringSet(x = geneAAsetsListuniq, filepath = "PierisNonRedundant.fas") #Checked in terminal - 310,369 lines?
length(geneAAsetsListuniq)
#Then use lapply and unique
geneAAsetsListuniq <- lapply(geneAAsetsList, unique)
geneAAsetsListuniq <- unlist(geneAAsetsList)
length(geneAAsetsListuniq)
#Then use lapply and unique
geneAAsetsListuniq <- lapply(geneAAsetsList, unique)
geneAAsetsListuniq <- unlist(geneAAsetsList)
length(geneAAsetsListuniq)
geneAAsetsListuniq
geneAAsetsList[[2]]
#Then use lapply and unique
geneAAsetsListuniq <- lapply(geneAAsetsList, unique)
geneAAsetsListuniq
geneAAsetsListuniq <- unlist(geneAAsetsListuniq)
length(geneAAsetsListuniq)
#Write out FASTA file
writeXStringSet(x = geneAAsetsListuniq, filepath = "PierisNonRedundant.fas") #Checked in terminal - 35,824 proteins?
geneAAsetsListuniq <- unlist(geneAAsetsListuniq)
length(geneAAsetsListuniq)
#Write out FASTA file
writeXStringSet(x = geneAAsetsListuniq, filepath = "PierisNonRedundant.fas") #Checked in terminal - 35,824 proteins?
#Then use lapply and unique
geneAAsetsListuniq <- lapply(geneAAsetsList, unique)
length(geneAAsetsListuniq)
#Write out FASTA file
writeXStringSet(x = geneAAsetsListuniq, filepath = "PierisNonRedundant.fas") #Checked in terminal - 35,824 proteins?
str(geneAAsetsListuniq)
#Write out FASTA file
writeXStringSet(x = geneAAsetsListuniq, filepath = "PierisNonRedundant.fas") #Checked in terminal - 35,824 proteins?
#--------------------------------------------------------------------------------------------------------------
#Select longest CDS
#Generate Object with longest CDS
##Necessary Code Previously Generated
prot.mtx <- do.call(what = rbind, args = geneID)
genesIDList <- split( x=prot.mtx[,1], f=prot.mtx[,2])
#Use split function (f = prot.mtx[,2])
geneAAsetsList <- split(pierisRenamedGenome, f = prot.mtx[,2])
#Then use lapply and unique
geneAAsetsListuniq <- lapply(geneAAsetsList, unique)
##THEN:
#Extract the longest sequence for each gene
#which.max gives you the index of which one is the longest or the max
#Want the length of the sequence
str(geneAAsetsListuniq)
indexSeq <- which.max(width(geneAAsetsListuniq[[2]])) #Index that reflects the longest transcript
geneAAsetsListuniq[[2]][indexSeq] #Subset to get longest StringSetObject
width(geneAAsetsListuniq[[2]][indexSeq])
#Create a function
getLongest <- function(x) {
indexSeq <- which.max(width(x))
longestSSObject <- x[indexSeq]
return(longestSSObject)
}
#Subset list in lapply to only include the ones that have > 1 transcript
getLongest(geneAAsetsListuniq[[2]])
#Put defined function into lapply
longestSeq <- lapply(geneAAsetsList, FUN = getLongest)
longestSeq <- unlist(longestSeq)
longestSeq <- unlist(longestSeq)
head(longestSeq)
width(longestSeq[[2]])
geneLength <- lapply(longestSeq, FUN = width)
head(geneLength)
##Whittle down to a single representative protein - longest one (for ortholog analysis)
#Write out FASTA file
writeXStringSet(x = longestSeq, filepath = "PierisLongestCDS.fas")
str(longestSeq)
##Whittle down to a single representative protein - longest one (for ortholog analysis)
#Write out FASTA file
writeXStringSet(x = longestSeq, filepath = "PierisLongestCDS.fas")
#Put defined function into lapply
longestSeq <- lapply(geneAAsetsList, FUN = getLongest)
longestSeq <- unlist(longestSeq)
head(longestSeq)
width(longestSeq[[2]])
##Whittle down to a single representative protein - longest one (for ortholog analysis)
#Write out FASTA file
writeXStringSet(x = longestSeq, filepath = "PierisLongestCDS.fas")
head(longestSeq)
##Whittle down to a single representative protein - longest one (for ortholog analysis)
#Write out FASTA file
write.fasta(sequences = longestSeq, names = names(longestSeq) , file.out = "PierisLongestCDS.fas", open = "w", as.string = FALSE)
write.fasta
##Whittle down to a single representative protein - longest one (for ortholog analysis)
#Write out FASTA file
writeXStringSet(x = longestSeq, filepath = "PierisLongestCDS.fas")
str(longestSeq)
longestSeq <- unlist(longestSeq)
str(longestSeq)
##Whittle down to a single representative protein - longest one (for ortholog analysis)
#Write out FASTA file
writeXString(x = longestSeq, filepath = "PierisLongestCDS.fas")
##Whittle down to a single representative protein - longest one (for ortholog analysis)
#Write out FASTA file
writeXStringSet(x = longestSeq, filepath = "PierisLongestCDS.fas")
unlist
#Write out FASTA file
writeXStringSet(x = geneAAsetsListuniq, filepath = "PierisNonRedundant.fas") #Checked in terminal - 35,824 proteins?
View(geneAAsetsList)
View(geneAAsetsListuniq)
View(geneAAsetsListuniq)
geneAAsetsListuniq <- unlist(geneAAsetsListuniq)
#Write out FASTA file
writeXStringSet(x = geneAAsetsListuniq, filepath = "PierisNonRedundant.fas") #Checked in terminal - 35,824 proteins?
AAsetsListuniq <- unlist(geneAAsetsListuniq)
length(geneAAsetsListuniq)
#Write out FASTA file
writeXStringSet(x = geneAAsetsListuniq, filepath = "PierisNonRedundant.fas") #Checked in terminal - 35,824 proteins?
#Write out FASTA file
writeXStringSet(x = AAsetsListuniq, filepath = "PierisNonRedundant.fas") #Checked in terminal - 35,824 proteins?
geneAAsetsListuniq <- unlist(geneAAsetsListuniq)
length(geneAAsetsListuniq)
#Write out FASTA file
writeXStringSet(x = geneAAsetsListuniq, filepath = "PierisNonRedundant.fas") #Checked in terminal - 35,824 proteins?
View(longestSeq)
##Whittle down to a single representative protein - longest one (for ortholog analysis)
#Write out FASTA file
writeXStringSet(x = longestSeq, filepath = "PierisLongestCDS.fas")
#Write out FASTA file
writeXStringSet(x = geneAAsetsListuniq, filepath = "PierisNonRedundant.fas") #Checked in terminal - 35,824 proteins?
#Write out FASTA file
writeXStringSet(x = geneAAsetsListuniq, filepath = "PierisNonRedundant.fas") #Checked in terminal - 35,824 proteins?
#Write out FASTA file
writeXStringSetList(x = geneAAsetsListuniq, filepath = "PierisNonRedundant.fas") #Checked in terminal - 35,824 proteins?
str(geneAAsetsListuniq)
head(geneAAsetsListuniq)
names(geneAAsetsListuniq)
write.fasta(sequences = geneAAsetsListuniq, names = names(geneAAsetsListuniq), file.out = "PierisNonRedundant.fas", open = "w", nbchar = 100, as.string = FALSE)
library(seqinr)
write.fasta(sequences = geneAAsetsListuniq, names = names(geneAAsetsListuniq), file.out = "PierisNonRedundant.fas", open = "w", nbchar = 100, as.string = FALSE)
write.fasta(sequences = longestSeq, names = names(longestSeq), file.out = "PierisLongestCDS.fas", open = "w", nbchar = 100, as.string = FALSE)
#--------------------------------------------------------------------------------------------------------------
#Part 3: Remove Redundant Sequences
#Reduce redundancy - still allows for isoforms
#Generate Object with non-redundancy
##Necessary Code Previously Generated
prot.mtx <- do.call(what = rbind, args = geneID)
genesIDList <- split( x=prot.mtx[,1], f=prot.mtx[,2])
#Use split function (f = prot.mtx[,2])
geneAAsetsList <- split(pierisGenome, f = prot.mtx[,2])
#Then use lapply and unique
geneAAsetsListuniq <- lapply(geneAAsetsList, unique)
#EXTRA: Clean the sequences
tmpchar <- as.character(pierisGenome)
tmpchar <- gsub(pattern = ".", x = tmpchar, fixed = T, replacement = "")
pierisGenome <- AAStringSet(tmpchar)
#Write out FASTA file
writeXStringSet(x = pierisGenome, filepath = "PierisRenamedProteins.fas")
#Write out FASTA file
writeXStringSet(x = pierisGenome, filepath = "PierisRenamedProteins.fas")
#--------------------------------------------------------------------------------------------------------------
#Part 3: Remove Redundant Sequences
#Reduce redundancy - still allows for isoforms
#Generate Object with non-redundancy
##Necessary Code Previously Generated
prot.mtx <- do.call(what = rbind, args = geneID)
genesIDList <- split( x=prot.mtx[,1], f=prot.mtx[,2])
#Use split function (f = prot.mtx[,2])
geneAAsetsList <- split(pierisGenome, f = prot.mtx[,2])
#Then use lapply and unique
geneAAsetsListuniq <- lapply(geneAAsetsList, unique)
geneAAsetsListuniq <- unlist(geneAAsetsListuniq)
length(geneAAsetsListuniq)
class(geneAAsetsListuniq)
geneAAsetsListuniq[1:3]
#Fix the data structure
geneAAsetsListuniq <- AAStringSetList(geneAAsetsListuniq)
geneAAsetsListuniq[1:3]
uniqAAstringset <- unlist(geneAAsetsListuniq)
class(uniqAAstringsest)
class(uniqAAstringset)
names(uniqAAstringset[1:3])
pierisGenome <- AAStringSet(tmpchar)
#--------------------------------------------------------------------------------------------------------------
#Part 3: Remove Redundant Sequences
#Reduce redundancy - still allows for isoforms
#Generate Object with non-redundancy
##Necessary Code Previously Generated
prot.mtx <- do.call(what = rbind, args = geneID)
genesIDList <- split( x=prot.mtx[,1], f=prot.mtx[,2])
#Use split function (f = prot.mtx[,2])
geneAAsetsList <- split(pierisGenome, f = prot.mtx[,2])
#Then use lapply and unique
geneAAsetsListuniq <- lapply(geneAAsetsList, unique)
geneAAsetsListuniq <- unlist(geneAAsetsListuniq)
length(geneAAsetsListuniq) #Sanity check
#Fix the data structure
geneAAsetsListuniq <- AAStringSetList(geneAAsetsListuniq)
uniqAAstringset <- unlist(geneAAsetsListuniq)
names(uniqAAstringset[1:3])
names(geneAAsetsListuniq) <- NA
uniqAAstringset <- unlist(geneAAsetsListuniq)
names(uniqAAstringset[1:3])
#Write out FASTA file
writeXStringSet(x = uniqAAstringset, filepath = "PierisNonRedundant.fas")
#Fix the data structure
longestCDS <- AAStringSetList(longestSeq)
longestCDS <- unlist(longestCDS)
##Whittle down to a single representative protein - longest one (for ortholog analysis)
#Write out FASTA file
writeXStringSet(x = longestCDS, filepath = "PierisLongestCDS.fas")
##Upload pierisGenome dataset
pierisGenome <- readAAStringSet(file = "Pieris_rapae_proteins.fa")
#--------------------------------------------------------------------------------------------------------------
#Part 1:  Cross reference TrxID with Gene Name and Gene ID
#Update names in FASTA file using the previously generated table
#Output 35000 genes
protNames <- names(pierisGenome)
#Use the `match()` function to subset geneinfo$GeneID in a way that is consistent with the ordering and identity of transcript IDs on AAstringset read from fasta.
trxList <- strsplit(names(pierisGenome), split = " gene=")  #Parse fasta header from AAStringSet into list of unique IDs
prot.mtx <- do.call(what = rbind, args = trxList) #Turn this list into a matrix, so can access only trxID or GeneName directly
prot.geneID <- geneinfo$GeneID[match(prot.mtx[,2], table = geneinfo$GeneName )] #Use match to get GeneID values corresponding to GeneNames in the fasta ordering
#--------------------------------------------------------------------------------------------------------------
#Part 2: Update headers in FASTA entry to contain GeneID
#Paste together to give the new IDs for the AAStringSet
newNames <- paste(prot.mtx[,1], prot.geneID, prot.mtx[,2])
newNamesKeys <- paste0(prot.mtx[,1], " geneID=", prot.geneID, " genename=", prot.mtx[,2])
names(pierisGenome) <- newNames
length(names(pierisGenome))
#EXTRA: Clean the sequences (remove ".")
tmpchar <- as.character(pierisGenome)
tmpchar <- gsub(pattern = ".", x = tmpchar, fixed = T, replacement = "")
pierisGenome <- AAStringSet(tmpchar)
#--------------------------------------------------------------------------------------------------------------
#Part 4: Reduce to longest CDS
#Generate Object with longest CDS
#Extract the longest sequence for each gene
#which.max gives you the index of which one is the longest or the max
#Want the length of the sequence
indexSeq <- which.max(width(geneAAsetsListuniq[[2]])) #Index that reflects the longest transcript
geneAAsetsListuniq[[2]][indexSeq] #Subset to get longest StringSetObject
width(geneAAsetsListuniq[[2]][indexSeq])
#Create a function
getLongest <- function(x) {
indexSeq <- which.max(width(x))
longestSSObject <- x[indexSeq]
return(longestSSObject)
}
#Subset list in lapply to only include the ones that have > 1 transcript
getLongest(geneAAsetsListuniq[[2]])
#Put defined function into lapply
longestSeq <- lapply(geneAAsetsList, FUN = getLongest)
longestSeq <- unlist(longestSeq)
#Fix the data structure
longestCDS <- AAStringSetList(longestSeq)
longestCDS <- unlist(longestCDS)
##Whittle down to a single representative protein - longest one (for ortholog analysis)
#Write out FASTA file
writeXStringSet(x = longestCDS, filepath = "PierisLongestCDS.fas")
